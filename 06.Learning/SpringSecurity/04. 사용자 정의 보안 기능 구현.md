
이번 시간은 인증 API 사용자 정의 보안 기능을 구현해보도록 하겠습니다. 
우리가 지난 시간에 Spring Security에 의존성을 추가했죠. 
의존성을 추가하고 우리가 서버를 기동하게 되면 Spring Security가 초기화되면서 웹 보안 기능을 활성화하고 
그리고 보안 기능이 우리의 시스템에 반영이 되어서 작동이 되도록 그런 과정을 살펴봤습니다. 

그런데 문제점이 있었죠. 보안 기능은 작동을 하는데 현재 우리 시스템은 계정이 지금 사용자 계정이 하나밖에 지금 없는 거죠. 유저 계정.
그리고 권한도 현재 시스템에는 추가되거나 변경되거나 하는 이런 기능이 없습니다. 
그리고 해커의 침입에 대비할 수 있는 어떤 보안 옵션 그런 기능도 지금 없죠.
그렇기 때문에 지금 우리의 보안 시스템은 아주 단순한 최소한의 기능만 가지고 있는 보안 시스템입니다. 

그래서 이런 문제점들을 우리가 개선해 나가고 더 보완해서 우리의 보안 시스템이 우리의 지금 시스템이 더 안전하고 강화된 보안 기능을 갖출 수 있도록
우리가 그 기능을 구현해야 되겠죠. 

그래서 이번 시간에는 사용자 정의 보안 기능 구현인데요. 
이 보안 기능을 구현하기 위해서 우리가 알아야 될 우리가 이해하고 있어야 될 항목들에 대해서 살펴보고 이번 시간에 사용자의 정의 보안 기능 그 설정 클래스를 만들어서 확인해보도록 하겠습니다. 
그러면 먼저 여기 WebSecurityConfigurerAdapter 이 클래스가 핵심적인 클래스예요.
이 클래스는 Spring Security의 Web 보안 기능을 초기화하고 설정을 하는 클래스입니다. 
그래서 우리가 지난 시간에 의존성을 추가할 때 초기화 되고 Spring Security가 초기화 되고 가장 기본적인 Web 보안 기능을 활성화하고
우리의 시스템에 보안 기능이 작동하게끔 설정을 하는 그 모든 처리를 하는 클래스가 바로 이 클래스예요. 

Web Security Configurer Adapter 이 클래스가 초기에 작업을 하는 겁니다. 
그리고 이 클래스는 http Security 이 클래스를 생성을 하고요. 그리고 이 클래스가 세부적인 보안 기능을 설정할 수 있는 API를 제공하고 있어요.

그래서 이 두 개의 클래스가 우리가 의존성을 추가했을 때 우리의 시스템에 가장 기본적인 Web 보안 기능을 활성화하고 그 보안 기능이 작동하게끔 그 역할을 하는 클래스가 이 두 개의 클래스입니다. 
그러면 우리가 이번 시간에는 이렇게 SecurityConfig 이름의 사용자 정의 보안 설정 클래스를 만들 겁니다. 
그리고 이 설정 클래스는 여기에 WebSecurityConfigurerAdapter 이 클래스를 상속받을 거고요. 그렇게 되면 우리가 만든 여기 SecurityConfig
이 설정 클래스 안에서 Http Security 이 클래스를 사용해서 세부적이고 좀 더 우리가 추가적으로 설정할 수 있는 그 API들을 활용해서 우리가 사용자 정의 보안 기능을 구현할 것입니다. 
그러면 Http Security 이 클래스는 인증 API와 인가 API 설정할 수 있는 여러 가지 API들을 제공하고 있어요. 

그래서 각각의 이 API들에 대해서 우리가 이번 시간부터 살펴볼 거고요 인가도 마찬가지입니다. 
그래서 어떤 역할을 하고 어떠한 처리 과정을 통해서 인증과 인가 처리를 할 수 있는지 그 과정들을 살펴볼 거고요.
그래서 이번 시간에 우리가 Security Config 이 설정 클래스를 만들어서 지금은 최소한의 Web 보안 기능만 작동하지만 우리가 직접 인증 API 인가 API를 추가해서 좀 더 보안에 안전한 그리고 더 강력한 그런 보안 시스템을 구축할 수 있도록 우리가 기능을 구현하도록 하겠습니다. 

그러면 우리가 설정 클래스를 만들 건데요. 설정 클래스는 이렇게 코드로 작성을 하도록 하겠습니다. 

@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

@Override
protected void configure(HttpSecurity http) throws Exception { 
	http
		.authorizeRequests()			
		.anyRequest().authenticated()		
	.and()
		.formLogin(); 			
}

SecurityConfig 이름의 설정 클래스고요 위에 WebSecurityConfigurerAdapter 이 클래스를 상속 받고요.

그리고 WebSecurityConfigurerAdapter 이 클래스가 가지고 있는 메소드 중에서 여기 http Security 이 클래스를 파라미터로 전달받는 configurer() 이 메소드를 우리가 오버라이드 할 겁니다. 

그래서 이 메소드 안에서 우리가 인증이나 인가와 관련된 API를 설정해서 우리만의 사용자 정의 보안 기능을 구현할 수 있도록 그렇게 하도록 하겠습니다. 
그러면 우리가 이 내용을 가지고 코드를 작성하도록 하겠습니다. 
그러면 Security Config 설정 클래스를 만들어보도록 하겠습니다. 
그전에 먼저 우리가 Web Security Configurer Adapter 이 클래스를 살펴보도록 하죠. 
이 클래스가 Spring Security가 초기화되면서 이 클래스를 호출하게 되고 이 클래스는 Spring Security의 초기화 작업에 여러 가지 작업들을 하게 됩니다. 
그 과정 속에서 제가 몇 가지만 확인을 하도록 하죠.

이렇게 해서 서버를 기동해보도록 하겠습니다.

이렇게 서버가 기동되면서 Spring Security가 이 클래스에 설정 클래스를 호출했고요. 여기 보시면 http Security 그 클래스의 객체를 지금 요청하고 있죠 그래서 보시면 현재 http Security 클래스를 생성하고 있습니다. 
생성하고 있고 이 클래스를 활용해서 사용해서 지금 보시면 대략 11개 정도의 11가지 정도의 API들을 호출하면서 설정 초기화 작업을 하고 있는 거예요. 
각각이 설정들이고요. 설정 클래스로 이동하는 API들이고요 가령 예를 들어서 Exception Handing Configurer.

예외를 처리하는, 그 설정을 하는 클래스고요. 이 클래스의 설정 클래스 안으로 들어오시면 여기서 필터도 생성하고 있죠. ExceptionTranslationFilter 우리가 나중에 배우겠지만 예외를 처리하는 인증과 인가 예외가 발생했을 때 그 예외를 처리하는 필터, 
ExceptionTranslationFilter 이 필터들도 생성을 하고 있습니다.

네 설정 과정에서 그래서 각각의 API가 설정을 호출하고 있고 설정 클래스를, 그다음에 그 설정 클래스가 각각의 필터들을 생성하고 있습니다. 
기본적으로 이렇게 제공이 되고 있어요. 
그러고 나서 여기 보시면 Config 메소드 호출하고 있죠. 그래서 여기서 추가적인 설정을 하고 있습니다.

그래서 http.authorizeRequests.anyRequest().authenticated() 이렇게 보안 설정을 하고 있죠. 그리고 formLogin().and().httpBasic()이지 이렇게 돼 있습니다. 
이 구문은 현재 사용자가 http 이 authorizeRequests() 방식으로 요청을 할 때 authenticated() 보안 검사를 한다는 거고요. 그리고 anyRequest() 어떠한 요청에도 어떠한 요청에도 authenticated() 인증을 받도록 API를 설정하고 있는 거예요. 

그리고 인증 방식은 formLogin() 방식과 httpBasic() 인증 방식을 제공하겠다. 

이렇게 지금 설정 API들을 이렇게 제공하고 있는 겁니다. 

그래서 이 설정 때문에 우리가 Spring Security가 초기화 되면 이 설정 때문에 우리가 루트 경로로 접속을  할지라도인증을 받지 않으면 다시 폼 로그인 방식으로 로그인하도록 로그인 페이지가 제공이 된 겁니다. 결국은 이 메소드 안에서 설정된 이 API 설정들 때문에 현재 Web 보안 기능이 활성화된 거죠. 
그러면 이제 우리가 WebSecurityConfigurerAdapter 이 클래스 상속을 받아서 우리만의 사용자 정의 보안 기능을 구현할 텐데요.

그 클래스를 만들고 우리가 여기 Configurer() 이 메소드를 오버라이드 해서 이 메소단에서 여기와 같은 인증과 인과 관련된 API들을 설정하면 우리만의 사용자 정의 보안 기능이 작동될 수 있도록 그렇게 구현이 되는 거죠. 이렇게 해서 초기화 작업이 종료가 됩니다. 
그러면 우리가 이렇게 localhost, 루트로 접속하게 되면 이렇게 로그인 페이지가 뜨죠. 
그래서 인증을 받지 않으면 현재 루트 경로로 접속이 안 되겠죠. 
그러면 우리가 이제 이 클래스를 상속받아서 사용자 정의 보안 기능을 구현하는 설정 클래스를 만들도록 하겠습니다. 
클래스 이름은 Security 컨피그 이렇게 이름을 주고요.

WebSecurityConfigurerAdapter 이 클래스를 상속을 받고 설정 클래스이기 때문에 @Configuration 어노테이션과 @EnableWebSecurityWebSecurity 이 어노테이션도 여기 선언을 해주셔야 돼요. 이 애노테이션은 Web Security Configuration 설정 클래스 그리고 여러 클래스들을 import에서 실행시키는 역할을 하는 애노테이션입니다. 
그래서 설정 클래스 위에다가 애노테이션을 명시를 해주셔야 돼요 그래야 Web 보안이 활성화됩니다. 
그러면 이제 우리가 API 인증과 인가 API를 추가적으로 설정할 수 있는 그 메소드를 Override 하도록 하겠습니다. 
그러면 http. 해서 먼저 Spring Security가 초기화되면서 설정하는 그 설정과 일단 유사하게 우리도 API를 설정하도록 하겠습니다.

authorizeRequests().anyRequest().authenticated();

이렇게 되면 요청에 대한 보안 검사가 시작되고 현재는 어떤 요청에도 인증을 받도록 우리가 설정을 했습니다. 

이게 인가 정책이고요 이제 인증 정책은 기본적으로 Form 로그인 방식으로 인증을 할 수 있도록 그렇게 API를 설정하도록 하겠습니다.

이렇게 간단하게 일단 설정을 하고요. 그리고 우리가 지금 서버를 기동하게 되면 기본적으로 패스워드가 이렇게 제공이 되죠. 
랜덤한 문자열로 그런데 계속 이 값을 복사해서 쓰기가 그러니까 우리가 직접 패스워드를 환경 설정 파일에 우리가 직접 작성을 해서 우리가 지정한 그 계정으로 인증을 할 수 있도록 그렇게 처리를 해보도록 하겠습니다. 
여기에 Application Properties  이 파일에 보시면 Spring 시큐리트 User.Name User.Password 작성을 해서 우리가 값을 줄 수가 있어요. 

이렇게 되면 기본적으로 우리가 이 계정을 가지고 인증할 때 로그인할 때 이 계정으로 시도할 수 있습니다. 
그래서 간단하게 우리가 작성을 했고요. 

그러면 다시 서버를 기동해서 현재 우리가 만든 이 설정 클래스에 있는 이 인증 API 인과 API 대로 보안 기능이 작동을 하는지 살펴보도록 하겠습니다. 
그래서 지금 우리가 만든 검색이요. 오버라이드한 메소드로 지금 호출이 되고 있죠. 그래서 지금 초기화된 과정인데 우리가 만든 설정대로 초기화가 이루어지고 있습니다.

그러면 루트 페이지로 가게 되면 인증을 받지 않으면 루트 경로로 접근이 안 되죠. 그래서 유저 계정으로 패스워드는 1111 해서 로그인하면 이렇게 홈으로 문자열이 출력됨을 볼 수 있습니다. 
그래서 정상적으로 우리가 만든 설정 클래스에서 메소드 오버라이딩 해서 우리가 지금 이렇게 API를 작성했는데요. 
우리가 작성한 이 API 대로 지금 보안 기능이 작동하고 있음을 확인했습니다. 
그래서 이번 시간에는 우리가 사용자 정의의 보안 기능을 직접 만들어 봤습니다. 
이제 이 클래스 위에서 이 메소드 안에서 인증 방식과 그리고 인가 처리를 위한 여러 가지 내용들을 또 추가하고요.

또 보안에 필요한 이제 보안 옵션 등 다양한 API들을 이 클래스 그리고 이 메소드단에서 작성하고 테스트하는 그런 시간들을 계속적으로 이어가도록 하겠습니다. 
그럼 이번 시간에는 여기까지 하도록 하겠습니다. 
수고하셨습니다. 감사합니다.
