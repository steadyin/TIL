Server 구축 27 + 17 + 12 + 20 + 41 + 14 + 38  + 9 = 2시간 49분
Linux : 4시간 43분
MySQL : 9시간 42분


# NCP

1. Windows 는 유료이기 때문에 별도 비용이 첨부되고 MSSQL은 Windows에서만 사용가능하다.

2. NCP > 요금계산기를 이용해본다.

3. 스토리지는 SSD를 써야한다. IO에서 부하가 심하기 때문에, 근데 노드는 IO를 Nonblock IO를 사용하기 때문에 좀 낫긴 하지만 SSD를 쓰는게 훨씬 빠릅니다.

4. 서버타입은 Standard 했다가 메모리, CPU가 부족할 때 바꾸면 됩니다. 이런 점이 클라우드의 장점입니다.

5. 보통 서버 스펙은 CPU 4개, 메모리 16GB로 가는데 시작이니 CPU 2개, 메모리 8GB로 가도 무방할 것입니다.

6. 이정도 스펙이 스타트업에서 사용하고 있는 스탠다드한 서버라고 생각하시면 됩니다.

7. 사용자가 많아지면 2,3대 늘리는 것이고 소켓이 공유가 안된다거나 그런 코딩이 안되어 있으면 서버 스펙을 늘리면 됩니다. 서버 스펙을 늘려서 버틸때 까지 버티는 겁니다. CPU와 메모리가 많이 향상 되면 네트워크에서 병목이 걸리겠죠. 네트워크도 성능을 향상 시키고 버틸 때 까지 버티는 동안에 이중화 작업을 하는 것이죠. HA 구성을 하는 것입니다.

![image](https://github.com/user-attachments/assets/7e303ee0-8798-4d9c-909d-dc6215cfd254)


8. 이제 DB를 구성해보겠습니다. VPC 라는 것은 내부망에 들어가겠다는 것입니다. 서버 타입은 Standard로 시작하고 CPU 2개, 메모리 8 GB, DB는 동접자가 많아지면 여러 커넥션이 붙죠. 우리가 노드가 2인데 또는 클라스터가 2대가 서비스하는데 DB는 1대에요. 그럼 CPU가 1대면 곤란하겠죠. 거기에 맞춰서 CPU를 쓰시면 됩니다. 

9. 마스터 / 슬레이브가 있는데 보시면 아시겠지만 리플리레이션 입니다. MySQL 시간에 배우겠지만 쓰는 것은 Master에서만 쓰고 Read는 슬레이브에서도 가능해요. 게시판을 만든다고 하면 게시판을 쓰는 것은 마스터에다가, 게시판을 읽는 사람들은 80-90%은 슬레이브에 붙겠죠. 그럼 서버가 3대니깐 DB가 병목이 안생깁니다.

10. 그래서 아까 말씀드린 IO에서 네트워크, 디스크, 데이터베이스 3개에서 병목이 많이 발생하는데 맞춰서 하시면 됩니다.

11. 데이터 스토리지 사용량은 50GB 면 충분한데 나중에 늘리면 됩니다.

12. 백업 스토리지 사용량은 이중화를 했는데 마스터에서 실수로 DELETE를 날렸어요. 마스터에서 지워진게 슬레이브에서도 지워지겠죠. 싱크로나이즈드 되니깐. 그랬을 떄 백업한 곳에서 가져와야하는데 그래서 백업을 꼭 해야합니다. 그래서 백업 스토리지도 50GB 잡습니다. 백업 스토리지는 HDD나 테이프를 사용해도 되는데
   
13. 아카이브 스토리지라고 해서 데이터를 압축해서 저장하는데 백업은 거의 복구할일이 없기 때문입니다.

14. 이렇게 하면 367,880원이 나오는데 보편적인 DB 구성이라고 보시면 됩니다.

![image](https://github.com/user-attachments/assets/864db34d-7868-4de1-8859-e15974ee39ac)

15. 서버, DB 총 합해서 50만원 정도가 나오는데, 스타트업을 하게되면 50만원 최소 나간다고 생각하셔야합니다.

------------------------------------------------------------------------------------------------------------------

16. 지금까지는 견적을 내본거였고 우리는 실제로 서버를 만들어보도록 하겠습니다.

```
가입   ⇒   결제 수단 등록  ⇒  10만원 크레딧 자동 부여
요금 계산하기 ⇒ 무료 Micro Server 사용 신청
- 1년 무상 Micro Server + 10만원(3개월) 크레딧 (공인IP 월 4,032원)
Classic 1세대 ⇒  Micro-g1 ⇒ Linux & HDD
```

17. 마이크로 서버는 무료는 Micro-g1, 1세대 서버이다. 1년 무상  Micro Server + 10만원(3개월) 크레딧 (공인 IP 월 4,032원)

18. 네이버 클라우드 서버 관리 페이지 접속 https://console.ncloud.com/dashboard

![image](https://github.com/user-attachments/assets/aa67a055-d405-4560-9915-1ab6e4317fed)

19. 이미지타입의 Application은 SaaS같은 애플리케이션을 우리가 만들때 선택한다. 

![image](https://github.com/user-attachments/assets/ccdb851a-6f3b-482d-afd3-2a0dfebbf1b2)

20. 우리는 스터디 목적이기 때문에 한 대의 서버에 DB, WAS를 구성할 예정입니다. 우리는 CentOS가 설치되어 있는 서버를 받아서 거기에 WAS, DB 를 구성할것입니다.

21. https://www.ncloud.com/support/faq/all/221?searchKeyword=classic&page=2

```
VPC(가상 사설 클라우드, Virtual Private Cloud)는 클라우드 서비스에서 제공하는 네트워킹 서비스입니다. 쉽게 말해서, 클라우드에서 당신만의 독립적인 네트워크 환경을 만드는 것이라고 생각할 수 있습니다. 이 VPC는 물리적인 데이터 센터와 비슷한 역할을 합니다.

VPC 안에서는 네트워크를 설정하여, 서버(인스턴스)를 배포하고, 트래픽을 제어하고, 보안 규칙을 설정할 수 있습니다. 예를 들어, 내부적으로만 통신할 수 있는 서버를 설정하거나, 외부에서 접근 가능한 서버를 둘 수 있습니다.
```
```
서브넷(Subnet)은 VPC(가상 사설 클라우드) 안에서 네트워크를 더 작은 단위로 나눈 구역을 말합니다. 즉, VPC 내에서 IP 주소 범위를 나누어 서로 다른 목적을 가진 네트워크 구역을 설정할 수 있도록 도와주는 역할을 합니다.

서브넷의 두 가지 유형
공용 서브넷 (Public Subnet): 인터넷과 직접적으로 연결될 수 있는 서브넷입니다. 여기에 배포된 인스턴스(서버)는 인터넷 게이트웨이(Internet Gateway)를 통해 인터넷에 접근할 수 있습니다. 일반적으로 웹 서버와 같이 외부에서 접근이 필요한 자원을 여기에 배포합니다.

사설 서브넷 (Private Subnet): 외부 인터넷과 직접적으로 연결되지 않는 서브넷입니다. 외부에서 접근할 수 없고, 내부적으로만 통신할 수 있도록 설정됩니다. 보통 데이터베이스나 애플리케이션 서버 등 인터넷에 노출되지 않아야 하는 자원을 배치하는 데 사용됩니다. 만약 사설 서브넷에 있는 자원이 인터넷에 접근할 필요가 있다면, NAT 게이트웨이를 통해서만 가능하게 설정할 수 있습니다.

서브넷은 네트워크 트래픽을 세분화하고, 보안 및 접근을 관리하는 데 중요한 역할을 합니다. 공용 서브넷은 외부와의 연결이 필요한 자원에, 사설 서브넷은 보안이 중요한 내부 자원에 사용됩니다.
```
```
10.0.0.0/24는 IP 주소 범위를 나타내는 표현으로, CIDR(Classless Inter-Domain Routing) 표기법을 사용한 것입니다. 이 표기법은 네트워크를 나누는 데 쓰이며, 특정 네트워크 범위를 정의할 때 사용됩니다.

표기의 구성
10.0.0.0: 네트워크 주소
/24: 서브넷 마스크 (네트워크 부분을 나타내는 비트의 개수)

1. 네트워크 주소 (10.0.0.0)
이 부분은 네트워크 범위의 시작 IP 주소를 나타냅니다. 10.0.0.0은 이 네트워크 범위의 첫 번째 주소로, 실제로는 "네트워크를 식별하는 주소"로 사용됩니다. 해당 네트워크 내의 호스트(기기)들이 사용할 수 있는 IP 주소 범위를 정의하는 시작점입니다.

2. 서브넷 마스크 (/24)
/24는 32비트 중 앞의 24비트를 네트워크 주소로 사용하고, 나머지 8비트를 호스트 주소로 사용할 수 있음을 의미합니다. 이를 통해 네트워크와 호스트 부분을 구분합니다.

서브넷 마스크는 이진수로 표현되는데, /24는 32비트 중 처음 24비트가 네트워크를 식별하고, 나머지 8비트가 호스트를 식별하는데 사용된다는 뜻입니다.

/24의 서브넷 마스크는 이진수로 보면 11111111.11111111.11111111.00000000입니다.
24개의 1은 네트워크 부분을 나타내고, 8개의 0은 호스트 부분을 나타냅니다.
```

22. 인증키는 ssh로 이 서버에 접속을 할 때 암호화된 개인 키(Private Key)를 생성합니다.

![image](https://github.com/user-attachments/assets/839c3c50-faa9-45c1-bbeb-0aea9799beaa)

23. ACG든 인증키는 혼동되지 않게 가져가는 좋다. 이 인증키 파일만 있으면 서버에 접속이 되고 이 ACG 이름만 있으면 다 같은 규칙을 따르는 거에요. 보안 규칙을.

24. 인증키를 생성하게 되면 아래쪽에 pem파일이 생성하게 됩니다. pem 파일이 있어야만 루트쪽 설정을 할 수 있습니다.

25. Access Control Group이라 해가지고 일종의 방화벽입니다. 외부에서 들어오는 침입을 차단시키는 거죠. 포트랑 출발지 IP만인데 일단 default로 가겠습니다.

26. 아래 메시지가 나오는데 무슨 의미일까요? Docker 이미지를 생성 하는 중이라는 의미겠죠. 생성하고 런닝 시키는 겁니다. 

![image](https://github.com/user-attachments/assets/e8635125-83b5-4696-838b-1ca7e6e3a950)

27. 이제 공인 IP를 세팅하겠습니다.(자동세팅됨)

![image](https://github.com/user-attachments/assets/a496a1f9-7a55-4a8b-bf23-352135062e56)

28. 서버 접속 공인 IP라고 되어 있는데 이 IP는 SSH로 접속할 때 그때 서버 IP입니다. 서비스 할 때는 이 IP로 들어오면 우리 서버를 못 찾겠죠. 단지 이 서버를 들어가기 위한 대문일뿐이죠.

![image](https://github.com/user-attachments/assets/aa79804a-e0be-41e0-8281-177d6cf591be)

30. 공인 IP에 대한 설명을 먼저 드리겠습니다.

![image](https://github.com/user-attachments/assets/3643e021-46e9-431d-a70b-4082cc42ce50)

31. PC에서 먼저 서버로 접속을 합니다. 맨 오른쪽이 우리 Server인데 Server로 접속을 하기 위해서는 115.85.180.78 IP로 SSH를 붙겠죠. 이 IP가 어디 있는지 어떻게 알까요? 라우터가 아는 것입니다. 라우터도 있고 Name 테이블을 갖고 있는 라우터랑 스위치 합해져서 장비가 나오는데 라우터에 IP를 물어보면 IP에 해당하는 서버가 어디있는지 알려줘요.

32. 우리가 인터넷을 SK를 쓴다고 하면 라우터를 SK가 갖고 있겠죠. SK 라우터한테 물어보면 실제 맥 어드레스로 되어있는 IP테이블이 있습니다. 실제 이 서버가 어디있는지를 찾아가는 겁니다. 우리 서버에는 22번 포트가 잠겨있습니다. 우리 서버의 22번 포트를 열려있지만. 맨 앞쪽에 있는 아까 외부 접속용 IP의 22번 포트는 잠겨있습니다. 그 서버에다가 포트 포워딩이라고 해서 50000번을 지정하면 50000번으로 들어오면 우리 서버로 연결하라고 조금 있다가 등록할거고 그것을 포트포워딩이라고 합니다.

33. 그래서 Private IP는 내부에서서 사용하는 것이고, 서버들이 IDC에 수백 수천개가 있겠죠. 그 내부에서 쓰는 IP고, Public IP는 외부에서 쓰는 IP입니다.

34. ACG를 설정하겠습니다. TCP/UPD차이는 대충 알것이고. 접근 소스는 출발지 입니다. 내 PC에서만 접속이 가능하게 하려면 내 PC IP를, 모든 곳에서 접속이 가능하게 하려면 0.0.0.0/0를 지정하면 됩니다. 22번 포트가 SSH죠. 예전에는 텔러를 썼지만 Secure SHell를 쓰는 것입니다. 그래야 패킷을 캡쳐해도 해커가 확인을 할 수 없겠죠. 이제 외부에서 들어오게 할것이기 때문에 80 포트를 열어두겠습니다. http포트죠.

 ![image](https://github.com/user-attachments/assets/7dd83a86-3194-4738-930b-0b0ddfad1892)

35. 그런데 80을 쓰는일은 거의 없을겁니다. http로 접속하면 아마 막을겁니다. 그래서 https를 추가해야합니다. 443이죠. 80은 테스트를 위해 열어둡니다.

36. 추가로 mysql 3306도 열어둡니다. 실제로 해커가 알수있기 때문에 3306를 잘쓰지는 않습니다.

37. 추가로 nosql 33060도 열어둡니다. 실제로 mysql8를 설치하면 nosql mysql, mysql 2개가 설치됩니다. 

38. flask & node는 8080, 8090 사용하지 않냐고 물어볼 수 있습니다. 그거는 안 엽니다. 열면 안됩니다. 앞에 80이나 443 포트가 있죠. NGINX가 받아서 포워딩 시킬겁니다.

39. FLASK와 NODE를 바로 열어두면 해커의 대상이 되기 될 가능성이 높기때문입니다. 데이터베이스 암호보다 더 취약합니다. 소스는 보기 힘들지만 우리 API가 문제입니다. NGINX에서 포워딩, 리다이렉트 시킬겁니다.

40. 이제 포트포워딩을 핻야합니다. 포트포워딩을 하지 않으면 외부에서 들어오질 못하겠죠. 그 대문을 지키고 문지기에게 이 포트를 갖고 들어오면 열어줄게. 그것을 해야합니다.

![image](https://github.com/user-attachments/assets/5869c3ef-63b6-4da6-93b2-9c72ce1c22c0)

41. 외부에서 50000포트로 들어오면 22로 연결하겠다는 의미죠. 이제 50000포트로 접속할 수 있습니다. (VPC는 포트포워딩 설정이 없다).

```
ssh root@106.10.46.114 -p 50000
```

42. 관리자 비밀번호를 설정합니다.

![image](https://github.com/user-attachments/assets/e20cf692-df35-471f-91e6-48d9557afe35)

43. 탐색기에서 아까 다운로드 받은 pem을 끌어다 놓습니다. 

![image](https://github.com/user-attachments/assets/8064ae45-ecce-4ab3-a756-eb471c5ea134)

44. 이제 다음과 같이 접속할 수 있습니다.

![image](https://github.com/user-attachments/assets/c3ae0a13-9ea9-4855-9481-a97ed967e6bf)

# 서버 확인




