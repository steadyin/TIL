# XXS(Cross-Site Scripting) ?

사이트 간 스크립팅(XSS)은 클라이언트측 스크립트를 웹 애플리케이션에 주입하는 것으로, 사용자 입력을 검증하고 올바르게 인코딩하지 않아 활성화된다. 악성 스크립트는 최종 사용자의 브라우저 내에서 실행되며, 최종 사용자 세션을 도용하는 것부터 최종 사용자가 수행한 모든 작업을 모니터링하고 변경하는 것까지 다양한 공격을 가능하게 한다. 

XXS 공격이 성공했다면 사용자 입력이 클라이언트 쪽 또는 서버 쪽에서 충분히 검증되지 않았다고 생각하면 된다. 검증에는 사용자의 요청을 안전하게 변경해서 XXS 공격을 방지하는 작업도 포함된다. 이런 검증 작업을 통해서 신뢰를 얻은 스크립트만이 쿠키나 세션 토큰 등에 접근할 수 있도록 해야 한다.

![image](https://user-images.githubusercontent.com/79847020/147270435-eb58149b-ed87-4e9b-b896-7ca567e0a07c.png)

1. 공격자는 기존 XSS 취약점이 있는 웹 사이트를 찾습니다.
2. 공격자는 사용자의 쿠키에 액세스할 수 있는 웹 사이트에 악의적인 스크립트를 주입합니다.
3. 감염된 웹 사이트를 방문할 때마다 악성 스크립트가 활성화됩니다.
4. 모든 사용자의 세션 쿠키가 공격자에게 전송됩니다.

# XXS 유형

XXS 공격에는 여러가지 유형이 잇는데 악의적인 스크립트가 비지속적인 방식으로 주입될 수 있는지 아니면 지속적인 방식으로 주입될 수 있는지에 따라 구분된다. 또는 클라이언트 사이드에서의 입력 유효성 검사에서 결함이 있는지 서버 사이드에서의 입력 유효성 검사에서 결함이 있는지에 따라 구분되기도 한다.

1. Stored XSS
2. Reflected XSS
3. Dom-based XSS

## Stored XSS

저장된 XXS 취약성을 통해 공격자는 지속적으롣 동작하는 악의적인 스크립트를 주입한다. Stored XSS의 한가지 예는 입력 필드를 통해 웹 서버에 입력되었을 수 있으며, 웹 서버는 충분한 유효성 검사를 수행하지 않고 스크립트를 데이터에 저장된다. 그 결과 웹을 방문하는 모든 사용자에게 이 스크립트를 전달되고 사용자의 세션 쿠키를 액스 하게 된다.

1. 스크립트가 웹 서버에 저장됨.
2. 대상은 저장된 스크립트를 포함하는 페이지에 접속하는 사용자
3. 스크립트가 웹 서버의 결함을 이용함.
4. 스크립 및 공격이 서버 기록에 남게됨.







여기에는 브라우저가 이 스크립트를 신뢰할 수 없다는 것을 모르기 때문에 해당 웹 사이트의 모든 사용자 작업을 변경하는 것이 포함된다. 이 스크립트는 신뢰할 수 있기 때문에 쿠키나 세션 토큰 등에 액세스하거나 HTML 페이지의 내용을 변경할 수 있다.

사용 중인 XSS의 종류에 따라 끈질기게 또는 비지속적으로 주입할 수 있다. 사이트 간 스크립팅 공격의 일반적인 차량에는 검색 양식, 포럼 또는 주석 섹션이 포함된다.



XSS(Cross-site Scripting)는 웹 상에서 가장 기초적인 취약점 공격 방법의 일종으로, 악의적인 사용자가 공격하려는 사이트에 스크립트를 넣는 기법을 말합니다. 공격에 성공하면 사이트에 접속한 사용자는 삽입된 코드를 실행하게 되며, 보통 의도치 않은 행동을 수행시키거나 쿠키나 세션 토큰 등의 민감한 정보를 탈취합니다. 







출처 : https://crashtest-security.com/cross-site-scripting-xss/

# XXS(Cross-Site Scripting)


공격 방법에 따라 Stored XSS와 Reflected XSS로 나뉜다.

Stored XSS는 사이트 게시판이나 댓글, 닉네임 등 스크립트가 서버에 저장되어 실행되는 방식이고, Reflected XSS는 보통 URL 파라미터(특히 GET 방식)에 스크립트를 넣어 서버에 저장하지 않고 그 즉시 스크립트를 만드는 방식이다. Reflected XSS의 경우 브라우저 자체에서 차단하는 경우가 많아 상대적으로 성공시키기 어려우므로 개발자가 주로 고려해야 될 것은 Stored XSS라고 생각하면 된다. 

## Stored XSS

공격자가 제공한 데이터가 서버에 저장된 후 지속적으로 서비스를 제공하는 정상 페이지에서 다른 사용자에게 스크립트가 노출되는 기법이다.

![image](https://user-images.githubusercontent.com/79847020/147257237-08d0ed27-1db8-45d5-b842-bdf721f26ed6.png)

## Reflected XSS

웹 어플리케이션의 지정된 파라미터를 사용할 때 발생하는 취약점을 이용한 공격법이다. 검색어 같은 쿼리스트링을 URL에 담아 전송했을 때, 서버가 필터링 하지 않고 쿼리에 포함된 스크립트를 응답 페이지에 담아 전송하므로서 발생한다. 

공격용 스크립트가 대상 웹사이트에 있지 않고 다른 매체(타 사이트, 이메일)에 포함될 수 있다.

## XXS 위험성

XSS로 발생할 수 있는 피해를 살펴보자.

1. 쿠키 정보 및 세션 ID 획득 



2. 시스템 관리자 권한 획득

XXS 취약점이 있는 웹 서버에 다양한 악성 데이터를 포함 시킨 후 사용자의 브라우저가 악성 데이터를 실행하게 할 수 있다. 

3. 악성코드 다운로드

XXS 공격은 악성 스킙트로 악성 프로그램을 다운로드 할 수는 없지만 악성 스크립트가 있는 URL을 클릭하도록 유도해 악성 프로그램을 다운받는 사이트로 리다이렉트(Redirect) 하거나 트로이 목마 프로그램을 다운로드 하도록 유도할 수 있다.

4. 거짓 페이지 노출

XXS 공격에 취약한 페이지일 경우 <Script> 태그 뿐만 아니라 <img>와 같은 그림을 표시하는 태그를 사용해 원래 페이지와는 전혀 관련이 없는 페이지를 표시할 수도 있다. 

## Spring Security로 애플리케이션 XSS를 안전하게 만들기




XSS와 CSRF의 가장 큰 차이점은 공격이 실행되는 위치입니다.

XSS는 희생자 클라이언트 PC에서 실행되며 사용자의 정보를 탈취하는 것이고, CSRF는 위조된 요청을 서버에 보내어 서버단에서 스크립트가 실행됩니다.

출처 

https://namu.wiki/w/XSS
https://www.acunetix.com/websitesecurity/cross-site-scripting/

# 방지법

## 1. XSS 취약점이 있는 innerHTML을 사용을 자제한다.

다행히도 HTML5 에서는 innerHTML을 통해 주입한 스크립트는 실행되지 않는다. 참고로 innerHTML을 HTML을 삽입하는 기능을 말한다.

```HTML
<script>alert('hello');</script>
```
하지만 여전히 스크립트를 실행할 방법이 있으니

onerror 이벤트 속성을 통한 스크립트 주입

<img src=x onerror=alert('xss attck')>

그러므로 꼭 필요한 경우가 아니라면 innerHTML을 통해 검증되지 않은 데이터를 넣지 말자.

textContent, innerText를 사용하면 스크립트가 주입되지 않는다. 

입력한 태그가 아래와 같이 치환되었다. 서버에서 치환처리()


  
